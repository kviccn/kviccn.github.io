import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as c,c as i,b as s,d as n,e as t,a as e}from"./app-0c3433bd.js";const l="/assets/Nacos-Release-c42cad23.png",u="/assets/Nacos-unzip-41c9f196.png",r="/assets/Nacos-Dashboard-51279e49.png",d="/assets/Nacos-app1-cfg-19598db5.png",k="/assets/Nacos-app1-cfg-content-bfef8ed0.png",v="/assets/Nacos-IDEA-face1db0.png",m="/assets/Nacos-Startup-Error-15e34eba.png",b="/assets/Nacos-IDEA-options1-b0c49562.png",g="/assets/Nacos-IDEA-options2-b6355c6f.png",h="/assets/Nacos-Startup-success-664a19cb.png",f="/assets/Nacos-Playground-Java-SDK-Fetch-Config-3e45787d.png",y="/assets/Nacos-Playground-Java-SDK-Listen-Config1-8809b877.png",w="/assets/Nacos-Playground-Java-SDK-Change-Config-102aeac1.png",_="/assets/Nacos-Playground-Java-SDK-Listen-Config2-9a1bfc38.png",N={},S={href:"https://nacos.io/",target:"_blank",rel:"noopener noreferrer"},x=s("h2",{id:"下载与启动",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#下载与启动","aria-hidden":"true"},"#"),n(" 下载与启动")],-1),q=s("p",null,"Nacos 作为一款开源软件我们可以选择使用构建好的安装包启动或者下载源码自行编译启动，下面分别演示两种方式。",-1),I=s("h3",{id:"通过构建好的安装包启动",tabindex:"-1"},[s("a",{class:"header-anchor",href:"#通过构建好的安装包启动","aria-hidden":"true"},"#"),n(" 通过构建好的安装包启动")],-1),C={href:"https://github.com/alibaba/nacos/releases",target:"_blank",rel:"noopener noreferrer"},A=s("code",null,"2.2.3",-1),P=e('<figure><img src="'+l+'" alt="Nacos Release" tabindex="0" loading="lazy"><figcaption>Nacos Release</figcaption></figure><p>我本机是 Windows 环境所以选择下载 <code>zip</code> 包，下载完成后解压到自定义目录。</p><figure><img src="'+u+`" alt="Nacos unzip" tabindex="0" loading="lazy"><figcaption>Nacos unzip</figcaption></figure><p>进入命令行并启动：</p><div class="language-powershell line-numbers-mode" data-ext="powershell"><pre class="language-powershell"><code>$ <span class="token punctuation">.</span>\\bin\\startup<span class="token punctuation">.</span>cmd <span class="token operator">-</span>m standalone
<span class="token string">&quot;nacos is starting with standalone&quot;</span>

         <span class="token punctuation">,</span><span class="token operator">--</span><span class="token punctuation">.</span>
       <span class="token punctuation">,</span><span class="token operator">--</span><span class="token punctuation">.</span><span class="token string">&#39;|
   ,--,:  : |                                           Nacos 2.2.3
,\`--.&#39;</span>\`<span class="token punctuation">|</span>  <span class="token string">&#39; :                       ,---.               Running in stand alone mode, All function modules
|   :  :  | |                      &#39;</span>   <span class="token punctuation">,</span><span class="token string">&#39;\\   .--.--.    Port: 8848
:   |   \\ | :  ,--.--.     ,---.  /   /   | /  /    &#39;</span>   Pid: 17884
<span class="token punctuation">|</span>   : <span class="token string">&#39;  &#39;</span><span class="token punctuation">;</span> <span class="token punctuation">|</span> <span class="token operator">/</span>       \\   <span class="token operator">/</span>     \\<span class="token punctuation">.</span>   <span class="token punctuation">;</span> <span class="token punctuation">,</span><span class="token punctuation">.</span> :<span class="token punctuation">|</span>  :  <span class="token operator">/</span>\`<span class="token punctuation">.</span><span class="token operator">/</span>   Console: http:<span class="token operator">/</span><span class="token operator">/</span>192<span class="token punctuation">.</span>168<span class="token punctuation">.</span>56<span class="token punctuation">.</span>1:8848/nacos/index<span class="token punctuation">.</span>html
<span class="token string">&#39;   &#39;</span> <span class="token punctuation">;</span><span class="token punctuation">.</span>    <span class="token punctuation">;</span><span class="token punctuation">.</span><span class="token operator">--</span><span class="token punctuation">.</span>  <span class="token punctuation">.</span><span class="token operator">-</span><span class="token punctuation">.</span> <span class="token punctuation">|</span> <span class="token operator">/</span>    <span class="token operator">/</span> <span class="token string">&#39;&#39;</span>   <span class="token punctuation">|</span> <span class="token punctuation">|</span>: :<span class="token punctuation">|</span>  :  <span class="token punctuation">;</span>_
<span class="token punctuation">|</span>   <span class="token punctuation">|</span> <span class="token punctuation">|</span> \\   <span class="token punctuation">|</span> \\__\\<span class="token operator">/</span>: <span class="token punctuation">.</span> <span class="token punctuation">.</span><span class="token punctuation">.</span>    <span class="token string">&#39; / &#39;</span>   <span class="token punctuation">|</span> <span class="token punctuation">.</span><span class="token punctuation">;</span> : \\  \\    \`<span class="token punctuation">.</span>      https:<span class="token operator">/</span><span class="token operator">/</span>nacos<span class="token punctuation">.</span>io
<span class="token string">&#39;   : |  ; .&#39;</span> <span class="token punctuation">,</span>&quot; <span class="token punctuation">.</span><span class="token operator">--</span><span class="token punctuation">.</span><span class="token punctuation">;</span> <span class="token punctuation">|</span><span class="token string">&#39;   ; :__|   :    |  \`----.   \\
|   | &#39;</span>\`<span class="token operator">--</span><span class="token string">&#39;  /  /  ,.  |&#39;</span>   <span class="token punctuation">|</span> <span class="token string">&#39;.&#39;</span><span class="token punctuation">|</span>\\   \\  <span class="token operator">/</span>  <span class="token operator">/</span>  <span class="token operator">/</span>\`<span class="token operator">--</span><span class="token string">&#39;  /
&#39;</span>   : <span class="token punctuation">|</span>     <span class="token punctuation">;</span>  :   <span class="token punctuation">.</span><span class="token string">&#39;   \\   :    : \`----&#39;</span>  <span class="token string">&#39;--&#39;</span><span class="token punctuation">.</span>     <span class="token operator">/</span>
<span class="token punctuation">;</span>   <span class="token punctuation">|</span><span class="token punctuation">.</span><span class="token string">&#39;     |  ,     .-./\\   \\  /            \`--&#39;</span><span class="token operator">--</span><span class="token operator">-</span><span class="token string">&#39;
&#39;</span><span class="token operator">--</span><span class="token operator">-</span><span class="token string">&#39;        \`--\`---&#39;</span>     \`<span class="token operator">--</span><span class="token operator">--</span><span class="token string">&#39;

2023-06-25 15:47:26,177 INFO Tomcat initialized with port(s): 8848 (http)

2023-06-25 15:47:26,436 INFO Root WebApplicationContext: initialization completed in 4840 ms

2023-06-25 15:47:33,300 INFO Adding welcome page: class path resource [static/index.html]

2023-06-25 15:47:34,244 WARN You are asking Spring Security to ignore Ant [pattern=&#39;</span><span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token string">&#39;]. This is not recommended -- please use permitAll via HttpSecurity#authorizeHttpRequests instead.

2023-06-25 15:47:34,245 INFO Will not secure Ant [pattern=&#39;</span><span class="token operator">/</span><span class="token operator">*</span><span class="token operator">*</span><span class="token string">&#39;]

2023-06-25 15:47:34,294 INFO Will secure any request with [org.springframework.security.web.context.request.async.WebAsyncManagerIntegrationFilter@1c52552f, org.springframework.security.web.context.SecurityContextPersistenceFilter@7645f03e, org.springframework.security.web.header.HeaderWriterFilter@2bc7db89, org.springframework.security.web.csrf.CsrfFilter@20999517, org.springframework.security.web.authentication.logout.LogoutFilter@671ea6ff, org.springframework.security.web.savedrequest.RequestCacheAwareFilter@7a6ea47d, org.springframework.security.web.servletapi.SecurityContextHolderAwareRequestFilter@6cbbb9c4, org.springframework.security.web.authentication.AnonymousAuthenticationFilter@5dc769f9, org.springframework.security.web.session.SessionManagementFilter@173f1614, org.springframework.security.web.access.ExceptionTranslationFilter@6ec63f8]

2023-06-25 15:47:34,376 INFO Exposing 1 endpoint(s) beneath base path &#39;</span><span class="token operator">/</span>actuator<span class="token string">&#39;

2023-06-25 15:47:34,488 INFO Tomcat started on port(s): 8848 (http) with context path &#39;</span><span class="token operator">/</span>nacos&#39;

2023-06-25 15:47:34<span class="token punctuation">,</span>543 INFO Nacos started successfully in stand alone mode<span class="token punctuation">.</span> use embedded storage
</code></pre><div class="highlight-lines"><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>观察程序输出日志中出现 <code>successfully</code> 则说明启动成功。</p><div class="hint-container tip"><p class="hint-container-title">提示</p><p>单机启动需要添加参数 <code> -m standalone</code>。</p></div>`,7),D={href:"http://localhost:8848/nacos",target:"_blank",rel:"noopener noreferrer"},E=e('<p>刚启动的 Nacos 中是没有任何配置和服务的：</p><figure><img src="'+r+`" alt="Nacos Dashboard" tabindex="0" loading="lazy"><figcaption>Nacos Dashboard</figcaption></figure><p>让我们通过 Nacos API 发布一个配置，通过 <code>curl</code> 调用如下接口发布配置：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">curl</span> <span class="token parameter variable">-X</span> POST <span class="token string">&#39;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=app1.cfg&amp;group=test&amp;content=HelloWorld&#39;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>请求方式为 <code>POST</code>，并且传入了三个参数 <code>dataId</code>、<code>group</code> 和 <code>content</code>，值分别为 <code>app1.cfg</code>、<code>test</code> 和 <code>HelloWorld</code>，Nacos 本身便是通过 <code>dataId</code> 和 <code>group</code> 来定位一个配置的。</p>`,5),F={class:"hint-container tip"},j=s("p",{class:"hint-container-title"},"提示",-1),z=s("code",null,"git-bash",-1),R={href:"https://www.postman.com/",target:"_blank",rel:"noopener noreferrer"},J=e(`<p>如上所述，我们也可以通过 Nacos API 来获取一个配置：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">curl</span> <span class="token parameter variable">-X</span> GET <span class="token string">&quot;http://127.0.0.1:8848/nacos/v1/cs/configs?dataId=app1.cfg&amp;group=test&quot;</span>
HelloWorld
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>同时也可以通过管理界面验证，再次查询可看到配置列表如下：</p><figure><img src="`+d+'" alt="Nacos app1.cfg" tabindex="0" loading="lazy"><figcaption>Nacos app1.cfg</figcaption></figure><p>点击详情可以看到内容也与我们设置的一致：</p><figure><img src="'+k+'" alt="Nacos app1.cfg content" tabindex="0" loading="lazy"><figcaption>Nacos app1.cfg content</figcaption></figure><h3 id="通过源码启动" tabindex="-1"><a class="header-anchor" href="#通过源码启动" aria-hidden="true">#</a> 通过源码启动</h3><div class="hint-container tip"><p class="hint-container-title">提示</p><p>此处我们选择通过 <code>idea</code> 启动 Nacos，以便调试和学习。</p></div><p>通过 <code>git</code> 将 nacos 源码克隆到本地 <code>git clone https://github.com/alibaba/nacos.git</code> 并导入 <code>idea</code>，如下：</p><figure><img src="'+v+'" alt="Nacos IDEA" tabindex="0" loading="lazy"><figcaption>Nacos IDEA</figcaption></figure><p>此时如果直接启动的话会提示有些类找不到，这需要先对项目进行编译，在 IDEA 中打开 Maven 工具栏，点击 <code>Toggle &#39;Skip Tests&#39; Mode</code>，点击 <code>compile</code> 等待编译完成后在运行主类。</p><p>再次运行发现还是会报错：</p><figure><img src="'+m+'" alt="Nacos Startup Error" tabindex="0" loading="lazy"><figcaption>Nacos Startup Error</figcaption></figure><p>这个问题很好解决，因为同样作为单机启动我们需要添加启动参数：</p><figure><img src="'+b+'" alt="Nacos IDEA options1" tabindex="0" loading="lazy"><figcaption>Nacos IDEA options1</figcaption></figure><div class="hint-container tip"><p class="hint-container-title">提示</p><p>添加启动参数 <code>-Dnacos.standalone=true</code></p></div><figure><img src="'+g+'" alt="Nacos IDEA options2" tabindex="0" loading="lazy"><figcaption>Nacos IDEA options2</figcaption></figure><p>再次运行：</p><figure><img src="'+h+'" alt="Nacos startup success" tabindex="0" loading="lazy"><figcaption>Nacos startup success</figcaption></figure><p>启动成功，通过源码和控制台输出我们也很容易看出来 Nacos 本身也是基于 spring boot 构建的。</p><h2 id="通过-java-sdk-管理配置" tabindex="-1"><a class="header-anchor" href="#通过-java-sdk-管理配置" aria-hidden="true">#</a> 通过 Java SDK 管理配置</h2>',21),K={href:"https://gradle.org/",target:"_blank",rel:"noopener noreferrer"},L=e(`<h3 id="获取配置" tabindex="-1"><a class="header-anchor" href="#获取配置" aria-hidden="true">#</a> 获取配置</h3><p>创建并进入项目根目录 <code>nacos-playground</code>，依次创建 settings 文件和 build 文件，内容分别如下：</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token comment">// filename: settings.gradle.kts</span>
rootProject<span class="token punctuation">.</span>name <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;nacos-playground&quot;</span></span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token comment">// filename: build.gradle.kts</span>
plugins <span class="token punctuation">{</span>
    java
<span class="token punctuation">}</span>

repositories <span class="token punctuation">{</span>
    <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;com.alibaba.nacos:nacos-client:2.2.3&quot;</span></span><span class="token punctuation">)</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;org.slf4j:slf4j-api:2.0.7&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>此时项目结构如下：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">find</span> <span class="token builtin class-name">.</span>
<span class="token builtin class-name">.</span>
./build.gradle.kts
./settings.gradle.kts
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>将项目导入 IDEA 并编写主类，内容如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">NacosFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">ConfigService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">NacosException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosPlayground</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NacosException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> serverAddr <span class="token operator">=</span> <span class="token string">&quot;localhost:8848&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// 指定服务器地址</span>
        <span class="token class-name">String</span> dataId <span class="token operator">=</span> <span class="token string">&quot;app1.cfg&quot;</span><span class="token punctuation">;</span>             <span class="token comment">// 指定配置 dataId</span>
        <span class="token class-name">String</span> group <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">;</span>                  <span class="token comment">// 指定配置 group</span>

        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;serverAddr&quot;</span><span class="token punctuation">,</span> serverAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ConfigService</span> configService <span class="token operator">=</span> <span class="token class-name">NacosFactory</span><span class="token punctuation">.</span><span class="token function">createConfigService</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> content <span class="token operator">=</span> configService<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span>dataId<span class="token punctuation">,</span> group<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取配置内容</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span>content<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><br><div class="highlight-line"> </div><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行程序输出结果如下：</p><figure><img src="`+f+`" alt="Nacos Playground Java SDK Fetch Config" tabindex="0" loading="lazy"><figcaption>Nacos Playground Java SDK Fetch Config</figcaption></figure><h3 id="监听配置" tabindex="-1"><a class="header-anchor" href="#监听配置" aria-hidden="true">#</a> 监听配置</h3><p>如果希望 Nacos 推送配置变更，可以使用 Nacos 动态监听配置接口来实现。</p><p>修改代码如下：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span></span><span class="token class-name">NacosFactory</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">ConfigService</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span>listener<span class="token punctuation">.</span></span><span class="token class-name">Listener</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>exception<span class="token punctuation">.</span></span><span class="token class-name">NacosException</span></span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span></span><span class="token class-name">Properties</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">Executor</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">java<span class="token punctuation">.</span>util<span class="token punctuation">.</span>concurrent<span class="token punctuation">.</span></span><span class="token class-name">TimeUnit</span></span><span class="token punctuation">;</span>

<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosPlayground</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token keyword">throws</span> <span class="token class-name">NacosException</span> <span class="token punctuation">{</span>
        <span class="token class-name">String</span> serverAddr <span class="token operator">=</span> <span class="token string">&quot;localhost:8848&quot;</span><span class="token punctuation">;</span>   <span class="token comment">// 指定服务器地址</span>
        <span class="token class-name">String</span> dataId <span class="token operator">=</span> <span class="token string">&quot;app1.cfg&quot;</span><span class="token punctuation">;</span>             <span class="token comment">// 指定配置 dataId</span>
        <span class="token class-name">String</span> group <span class="token operator">=</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">;</span>                  <span class="token comment">// 指定配置 group</span>

        <span class="token class-name">Properties</span> properties <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">Properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        properties<span class="token punctuation">.</span><span class="token function">put</span><span class="token punctuation">(</span><span class="token string">&quot;serverAddr&quot;</span><span class="token punctuation">,</span> serverAddr<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token class-name">ConfigService</span> configService <span class="token operator">=</span> <span class="token class-name">NacosFactory</span><span class="token punctuation">.</span><span class="token function">createConfigService</span><span class="token punctuation">(</span>properties<span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token class-name">String</span> content <span class="token operator">=</span> configService<span class="token punctuation">.</span><span class="token function">getConfig</span><span class="token punctuation">(</span>dataId<span class="token punctuation">,</span> group<span class="token punctuation">,</span> <span class="token number">5000</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 获取配置内容</span>
        <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;初始内容: &quot;</span> <span class="token operator">+</span> content<span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 为配置添加监听器</span>
        configService<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>dataId<span class="token punctuation">,</span> group<span class="token punctuation">,</span> <span class="token keyword">new</span> <span class="token class-name">Listener</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token class-name">Executor</span> <span class="token function">getExecutor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>

            <span class="token annotation punctuation">@Override</span>
            <span class="token keyword">public</span> <span class="token keyword">void</span> <span class="token function">receiveConfigInfo</span><span class="token punctuation">(</span><span class="token class-name">String</span> configInfo<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                <span class="token comment">// 实现配置更新后的回调方法</span>
                <span class="token class-name">System</span><span class="token punctuation">.</span>out<span class="token punctuation">.</span><span class="token function">println</span><span class="token punctuation">(</span><span class="token string">&quot;当前内容: &quot;</span> <span class="token operator">+</span> configInfo<span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

        <span class="token comment">// 死循环使主线程不退出，正式代码中无需下面代码</span>
        <span class="token keyword">while</span> <span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token keyword">try</span> <span class="token punctuation">{</span>
                <span class="token class-name">TimeUnit</span><span class="token punctuation">.</span><span class="token constant">SECONDS</span><span class="token punctuation">.</span><span class="token function">sleep</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span> <span class="token keyword">catch</span> <span class="token punctuation">(</span><span class="token class-name">InterruptedException</span> e<span class="token punctuation">)</span> <span class="token punctuation">{</span>
                e<span class="token punctuation">.</span><span class="token function">printStackTrace</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><div class="highlight-line"> </div><br><br><br><br><br><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>运行结果如下：</p><figure><img src="`+y+'" alt="Nacos Playground Java SDK Listen Config1" tabindex="0" loading="lazy"><figcaption>Nacos Playground Java SDK Listen Config1</figcaption></figure><p>可以看到在获取到初始配置内容后程序并没有退出。</p><p>在管理界面修改并发布配置：</p><figure><img src="'+w+'" alt="Nacos Playground Java SDK Change Config" tabindex="0" loading="lazy"><figcaption>Nacos Playground Java SDK Change Config</figcaption></figure><p>回到程序控制台，发现程序已打印出最新配置：</p><figure><img src="'+_+'" alt="Nacos Playground Java SDK Listen Config2" tabindex="0" loading="lazy"><figcaption>Nacos Playground Java SDK Listen Config2</figcaption></figure>',21),O={href:"https://nacos.io/zh-cn/docs/v2/guide/user/sdk.html",target:"_blank",rel:"noopener noreferrer"},T=e(`<h2 id="整合-spring-boot" tabindex="-1"><a class="header-anchor" href="#整合-spring-boot" aria-hidden="true">#</a> 整合 Spring Boot</h2><p>修改 Gradle 构建脚本：</p><div class="language-kotlin line-numbers-mode" data-ext="kt"><pre class="language-kotlin"><code><span class="token comment">// filename: build.gradle.kts</span>
plugins <span class="token punctuation">{</span>
    java
    <span class="token function">id</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;org.springframework.boot&quot;</span></span><span class="token punctuation">)</span> version <span class="token string-literal singleline"><span class="token string">&quot;2.7.13&quot;</span></span>
<span class="token punctuation">}</span>

<span class="token function">apply</span><span class="token punctuation">(</span>plugin <span class="token operator">=</span> <span class="token string-literal singleline"><span class="token string">&quot;io.spring.dependency-management&quot;</span></span><span class="token punctuation">)</span>

repositories <span class="token punctuation">{</span>
    <span class="token function">mavenCentral</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

dependencies <span class="token punctuation">{</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;org.springframework.boot:spring-boot-starter-web&quot;</span></span><span class="token punctuation">)</span>
    <span class="token function">implementation</span><span class="token punctuation">(</span><span class="token string-literal singleline"><span class="token string">&quot;com.alibaba.boot:nacos-config-spring-boot-starter:0.2.12&quot;</span></span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>新增配置文件：</p><div class="language-properties line-numbers-mode" data-ext="properties"><pre class="language-properties"><code><span class="token comment"># filename: application.properties</span>
<span class="token key attr-name">nacos.config.server-addr</span><span class="token punctuation">=</span><span class="token value attr-value">127.0.0.1:8848</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>修改主类，使用 <code>@NacosPropertySource</code> 加载 dataId 为 <code>nacos-playground</code> 的配置源，并开启自动更新：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>spring<span class="token punctuation">.</span>context<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span>config<span class="token punctuation">.</span></span><span class="token class-name">NacosPropertySource</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span></span><span class="token class-name">SpringApplication</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>boot<span class="token punctuation">.</span>autoconfigure<span class="token punctuation">.</span></span><span class="token class-name">SpringBootApplication</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@SpringBootApplication</span>
<span class="token annotation punctuation">@NacosPropertySource</span><span class="token punctuation">(</span>dataId <span class="token operator">=</span> <span class="token string">&quot;nacos-playground&quot;</span><span class="token punctuation">,</span> autoRefreshed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">NacosPlayground</span> <span class="token punctuation">{</span>

    <span class="token keyword">public</span> <span class="token keyword">static</span> <span class="token keyword">void</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token class-name">String</span><span class="token punctuation">[</span><span class="token punctuation">]</span> args<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token class-name">SpringApplication</span><span class="token punctuation">.</span><span class="token function">run</span><span class="token punctuation">(</span><span class="token class-name">NacosPlayground</span><span class="token punctuation">.</span><span class="token keyword">class</span><span class="token punctuation">,</span> args<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>新增 Controller 类并通过 Nacos 的 <code>@NacosValue</code> 注解设置属性值：</p><div class="language-java line-numbers-mode" data-ext="java"><pre class="language-java"><code><span class="token keyword">package</span> <span class="token namespace">example</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token import"><span class="token namespace">com<span class="token punctuation">.</span>alibaba<span class="token punctuation">.</span>nacos<span class="token punctuation">.</span>api<span class="token punctuation">.</span>config<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">NacosValue</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">GetMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RequestMapping</span></span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token import"><span class="token namespace">org<span class="token punctuation">.</span>springframework<span class="token punctuation">.</span>web<span class="token punctuation">.</span>bind<span class="token punctuation">.</span>annotation<span class="token punctuation">.</span></span><span class="token class-name">RestController</span></span><span class="token punctuation">;</span>

<span class="token annotation punctuation">@RestController</span>
<span class="token annotation punctuation">@RequestMapping</span><span class="token punctuation">(</span><span class="token string">&quot;config&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">public</span> <span class="token keyword">class</span> <span class="token class-name">ConfigController</span> <span class="token punctuation">{</span>

    <span class="token annotation punctuation">@NacosValue</span><span class="token punctuation">(</span>value <span class="token operator">=</span> <span class="token string">&quot;\${name}&quot;</span><span class="token punctuation">,</span> autoRefreshed <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
    <span class="token keyword">private</span> <span class="token class-name">String</span> name<span class="token punctuation">;</span>

    <span class="token annotation punctuation">@GetMapping</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">public</span> <span class="token class-name">String</span> <span class="token function">getName</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">return</span> name<span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="highlight-lines"><br><br><br><br><br><br><br><br><br><br><br><div class="highlight-line"> </div><br><br><br><br><br><br><br></div><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>在 Nacos 管理界面新增配置 dataId 为 <code>nacos-playground</code>，group 为 <code>DEFAULT_GROUP</code>，配置内容为 <code>name=laoli</code>。</p><p>启动应用并访问新增的接口：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">curl</span> http://localhost:8080/config/name
laoli
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>进入配置管理界面修改配置内容为 <code>name=weiyang</code>，再次请求接口：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>$ <span class="token function">curl</span> http://localhost:8080/config/name
weiyang
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>可以看到返回值已动态更新为配置中心的最新值。</p>`,15);function W(G,M){const a=o("ExternalLinkIcon");return c(),i("div",null,[s("p",null,[s("a",S,[n("Nacos"),t(a)]),n(" 是一个更易于构建云原生应用的动态服务发现、配置管理和服务管理平台。")]),x,q,I,s("p",null,[n("构建好的安装包可以在 "),s("a",C,[n("Github Release 页面"),t(a)]),n("下载，本文写作时最新版本为 "),A,n("，下载地址如下：")]),P,s("p",null,[n("此时可通过浏览器打开 "),s("a",D,[n("http://localhost:8848/nacos"),t(a)]),n(" 进入 Nacos 控制台。")]),E,s("div",F,[j,s("p",null,[n("这里的 cURL 命令是通过 "),z,n(" 调用的，如果没有安装的话也可以通过 "),s("a",R,[n("Postman"),t(a)]),n(" 调用。")])]),J,s("p",null,[n("我们的示例项目将通过 Gradle 构建，所以请先正确安装 "),s("a",K,[n("Gradle"),t(a)]),n("。")]),L,s("p",null,[n("更多关于 Java SDK 的操作请查阅"),s("a",O,[n("官方文档"),t(a)]),n("。")]),T])}const $=p(N,[["render",W],["__file","Nacos快速开始.html.vue"]]);export{$ as default};
